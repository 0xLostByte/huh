<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ØªØ­Ø¯ÙŠ Ù„Ø¤ÙŠ</title>
<style>
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙØ­Ø© */
    body {
        margin: 0; padding: 0; height: 100vh;
        background: black;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden; color: white;
        text-align: center; display: flex;
        justify-content: center; align-items: center;
        transition: background 1s ease;
    }

    /* Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ */
    #start-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 1000;
        display: none;
        flex-direction: column; justify-content: center; align-items: center;
        cursor: pointer;
    }
    .start-btn {
        padding: 20px 40px; font-size: 24px; font-weight: bold;
        background: #ff4d6d; color: white; border: none;
        border-radius: 50px; cursor: pointer;
        box-shadow: 0 0 20px rgba(255, 77, 109, 0.6);
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    #mainVideo, #darkVideo { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        object-fit: cover; z-index: 10; display: none; 
    }
    #darkVideo { z-index: 300; } /* ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
    
    /* Ø§Ù„Ø­ÙˆØ§Ø± */
    #dialogueOverlay { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); 
        z-index: 20; display: none; flex-direction: column; 
        justify-content: center; align-items: center; padding: 20px; 
    }
    .dialogue-text { font-size: 30px; font-weight: bold; color: #fff; text-shadow: 0 0 10px #ff69b4; opacity: 0; transition: opacity 0.5s; }

    /* Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø´Ø§Ø´Ø© (Ù„Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯) */
    #centerOverlay {
        position: fixed; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        font-size: 35px; font-weight: bold; color: white;
        text-shadow: 2px 2px 10px red, -2px -2px 10px blue;
        z-index: 400; display: none;
        text-align: center;
        width: 90%;
        line-height: 1.5;
    }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
    .glass-box { 
        position: relative; z-index: 30; 
        background: rgba(255, 255, 255, 0.15); 
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
        border-radius: 20px; padding: 20px; 
        width: 90%; max-width: 400px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        border: 1px solid rgba(255,255,255,0.3); 
        display: none; 
        transition: transform 0.3s; 
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
    #wrongPopup {
        position: relative; 
        width: 100%; height: 200px; 
        background: black; border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        margin-bottom: 20px; display: none; overflow: hidden;
    }
    #wrongVideo { width: 100%; height: 100%; object-fit: cover; }
    
    #wrongOverlayText {
        position: absolute; bottom: 20px; left: 50%; 
        transform: translateX(-50%); width: 90%;
        color: white; font-size: 16px; font-weight: bold;
        background: rgba(0, 0, 0, 0.6); 
        padding: 8px 12px; border-radius: 20px;
        text-shadow: 1px 1px 3px black; z-index: 5; pointer-events: none;
    }

    .timer { font-size: 40px; font-weight: bold; color: #ffeb3b; margin-bottom: 15px; }
    .question { font-size: 24px; margin-bottom: 25px; font-weight: bold; line-height: 1.4; dir: ltr; }
    .options-locked { pointer-events: none; opacity: 0.8; }
    .option-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: rgba(255,255,255,0.9); color: #333; border: none; border-radius: 12px; font-size: 18px; cursor: pointer; transition: 0.2s; direction: ltr; }
    .option-btn:active { transform: scale(0.95); }
    .correct-highlight { background-color: #2ecc71 !important; color: white !important; box-shadow: 0 0 15px #2ecc71; transform: scale(1.05); }
    .wrong-highlight { background-color: #e74c3c !important; color: white !important; }

    #praiseText {
        color: white; font-size: 28px; font-weight: bold;
        text-shadow: 0 0 15px #fff, 0 0 20px #ff4d6d;
        margin-bottom: 15px; display: none;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
    .ad-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 50; display: none; flex-direction: column; justify-content: center; align-items: center; }
    .ad-overlay video { width: 100%; height: auto; object-fit: contain; }
    
    .skip-btn { 
        position: absolute; bottom: 30px; right: 20px; 
        background: #5c4b18; color: #ccc; 
        padding: 12px 25px; border: 2px solid #3d3210; 
        border-radius: 0px; cursor: pointer; display: none; 
        z-index: 60; font-size: 16px; font-family: 'Courier New', Courier, monospace;
    }
    
    #adMessage {
        position: absolute; top: 15%; width: 100%;
        text-align: center; color: white; font-size: 28px;
        font-weight: bold; text-shadow: 2px 2px 8px black;
        z-index: 70; display: none; 
    }
    
    #loay-chat { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 15px 25px; border-radius: 25px; font-size: 18px; color: #00ffea; z-index: 100; display: none; width: 85%; text-align: center; border: 1px solid #00ffea; }

    /* === Ø³ØªØ§ÙŠÙ„ Ù†ÙˆØ§ÙØ° Ø§Ù„ÙÙŠØ±ÙˆØ³ === */
    .virus-window {
        position: absolute;
        width: 300px; 
        height: 200px;
        /* Ø¨Ø¯ÙˆÙ† Ø¥Ø·Ø§Ø± Ø£Ø­Ù…Ø± */
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        z-index: 200;
        animation: popUpAnim 0.1s ease-out;
        background: black;
        overflow: hidden;
    }
    .virus-window video {
        width: 100%; height: 100%; object-fit: cover;
    }
    @keyframes popUpAnim { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
</style>
</head>
<body>

<audio id="yayAudio" src="yay.mp3"></audio>
<audio id="partyAudio" src="party.mp3"></audio>
<audio id="wrongAudio" src="wrong1.mp3"></audio>

<canvas id="confettiCanvas"></canvas>

<div id="start-overlay">
    <button class="start-btn" onclick="playForcedManually()">ØªØ¹Ø¨ÙŠ Ø§ÙŠØ¯Ùƒ Ø§Ù„Ø­Ù„ÙˆÙ‡ Ùˆ Ø§Ø¶ØºØ·ÙŠ</button>
</div>

<video id="mainVideo" playsinline></video>
<video id="darkVideo" src="dark1.mp4" playsinline></video>

<div id="dialogueOverlay">
    <div class="dialogue-text" id="dialogueText"></div>
</div>

<div id="centerOverlay"></div>

<div id="virusContainer"></div>

<div class="glass-box" id="quizBox">
    <div id="wrongPopup">
        <video id="wrongVideo" src="wrong.mp4" playsinline></video>
        <div id="wrongOverlayText"></div>
    </div>
    <div id="praiseText"></div> 
    <div class="timer" id="timer">60</div>
    <div class="question" id="qText" dir="ltr"></div>
    <div id="options"></div>
</div>

<div class="ad-overlay" id="adLayer">
    <div id="adMessage"></div> 
    <h3 style="position:absolute; top:20px; left:20px; color:white; z-index:55; font-size:20px; font-weight:bold;">AD!</h3>
    <video id="adVideo" src="https://res.cloudinary.com/dpvvxtuny/video/upload/ad1_pu40fk.mp4" playsinline muted></video>
    <div class="skip-btn" id="skipBtn" onclick="handleSkipClick()">Skip Ad</div>
</div>

<div id="loay-chat"></div>

<script>
    const status = sessionStorage.getItem("meStatus");
    const startOverlay = document.getElementById("start-overlay");
    const mainVideo = document.getElementById("mainVideo");
    const darkVideo = document.getElementById("darkVideo");
    const dialogueOverlay = document.getElementById("dialogueOverlay");
    const dialogueText = document.getElementById("dialogueText");
    const centerOverlay = document.getElementById("centerOverlay");
    const quizBox = document.getElementById("quizBox");
    const adLayer = document.getElementById("adLayer");
    const skipBtn = document.getElementById("skipBtn");
    const loayChat = document.getElementById("loay-chat");
    const adVideo = document.getElementById("adVideo");
    const adMessage = document.getElementById("adMessage");
    const virusContainer = document.getElementById("virusContainer");
    const yayAudio = document.getElementById("yayAudio");
    const partyAudio = document.getElementById("partyAudio");
    const wrongAudio = document.getElementById("wrongAudio");
    const praiseText = document.getElementById("praiseText");
    const wrongPopup = document.getElementById("wrongPopup");
    const wrongVideo = document.getElementById("wrongVideo");
    const wrongOverlayText = document.getElementById("wrongOverlayText");
    const optionsDiv = document.getElementById("options");

    // === Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===
    const questions = [
        { q: "5 + 6 = ?", opts: ["10", "11", "12"], ans: 1, time: 60 },
        { q: "10 + 2 Ã— 5 = ?", opts: ["60", "20", "25"], ans: 1, time: 40 },
        { q: "50 - 5 Ã— 5 + 5 = ?", opts: ["0", "230", "30"], ans: 2, time: 30 },
        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙƒØªØ¨ ÙˆÙ„Ø§ ÙŠÙ‚Ø±Ø£ØŸ", opts: ["Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø³Ø§Ø¹Ø©", "Ø§Ù„ÙƒØªØ§Ø¨"], ans: 0, time: 20 },
        { q: "Ø¨Ø³Ø±Ø¹Ø©! 50 Ã· 2 + 5ØŸ", opts: ["30", "25", "35"], ans: 0, time: 10 }
    ];

    let qIndex = 0;
    let timerInterval;
    let skipAttempts = 0;
    let currentMistakes = 0; 
    const delay = (ms) => new Promise(res => setTimeout(res, ms));

    window.onload = function() {
        mainVideo.style.display = "block";
        resizeCanvas();
        if (status === 'forced') {
            startOverlay.style.display = "flex";
            mainVideo.src = "forced.mp4";
        } else {
            startOverlay.style.display = "none";
            startLoveScenario();
        }
    };
    window.onresize = resizeCanvas;

    function playForcedManually() {
        startOverlay.style.display = "none";
        mainVideo.muted = false;
        mainVideo.play();
        mainVideo.onended = () => {
            mainVideo.style.display = "none";
            showDialogueSequence([
                { text: "Ù…Ø§ ØªÙˆÙ‚Ø¹Øª Ø§Ù†Ùˆ Ø§ÙƒÙˆÙ† Ø§Ø®Ø± ÙˆØ§Ø­Ø¯ğŸ˜”", time: 3000 },
                { text: "ÙÙŠ Ø§Ø³Ø¦Ù„Ù‡ Ù„Ø§Ø²Ù… ØªØ¬Ø§ÙˆØ¨ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ Ù‡ÙŠÙ‡ÙŠ", time: 3000 },
                { text: "good luck", time: 2000 }
            ]);
        };
    }

    function startLoveScenario() {
        mainVideo.src = "homer.mp4";
        mainVideo.muted = true;
        var p = mainVideo.play();
        if(p !== undefined){
            p.then(_=>{ setTimeout(()=>{ mainVideo.muted = false; }, 1000); }).catch(e=>{ console.log("Autoplay blocked"); });
        }
        mainVideo.onended = () => {
            mainVideo.src = "kiss.mp4";
            mainVideo.muted = false;
            mainVideo.play();
            mainVideo.onended = () => {
                mainVideo.style.display = "none";
                showDialogueSequence([
                    { text: "Ù†ÙˆØ±ØªÙŠ ÙŠ Ø¹ÙŠÙˆÙ†ÙŠ ÙƒÙ…Ø§Ù† Ù…Ø±Ù‡", time: 3000 },
                    { text: "Ø´ÙˆÙÙŠ Ø¨ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ø³Ø¦Ù„Ù‡ Ù„Ø§Ø²Ù… ØªØ¬Ø§ÙˆØ¨ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ ÙˆØ§Ø­Ø¨Ùƒ", time: 3000 },
                    { text: "ÙˆØµØ­ Ø§Ù†ØªØ¨Ù‡ÙŠ ØªØ¬Ø§ÙˆØ¨ÙŠ ØºÙ„Ø·", time: 5000 }, 
                    { text: "good luck", time: 2000 }
                ]);
            };
        };
    }

    function showDialogueSequence(messages) {
        dialogueOverlay.style.display = "flex";
        let i = 0;
        function showNext() {
            if (i < messages.length) {
                dialogueText.style.opacity = 0;
                dialogueText.innerText = messages[i].text;
                setTimeout(() => { dialogueText.style.opacity = 1; }, 100);
                setTimeout(() => { i++; showNext(); }, messages[i].time);
            } else {
                dialogueOverlay.style.display = "none";
                startQuiz();
            }
        }
        showNext();
    }

    function startQuiz() {
        document.body.style.background = "linear-gradient(135deg, #1e3c72, #2a5298, #ff7a8a)";
        quizBox.style.display = "block";
        loadQuestion();
    }

    function loadQuestion() {
        optionsDiv.classList.remove("options-locked");
        currentMistakes = 0; 
        praiseText.style.display = "none";
        
        const oldBtns = document.querySelectorAll('.option-btn');
        oldBtns.forEach(btn => {
            btn.classList.remove('correct-highlight', 'wrong-highlight');
        });

        if (qIndex === 5) { 
            triggerAdSequence(); 
            return; 
        }

        if (qIndex >= questions.length) {
            alert("Ø®Ù„ØµÙ†Ø§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰"); 
            return; 
        } 

        const q = questions[qIndex];
        document.getElementById("qText").innerText = q.q;
        optionsDiv.innerHTML = "";
        
        let timeLeft = q.time;
        document.getElementById("timer").innerText = timeLeft;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft;
            if(timeLeft <= 0) { 
                clearInterval(timerInterval); 
                currentMistakes++; 
                playPunishment(-1); 
            }
        }, 1000);

        q.opts.forEach((opt, idx) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, q.ans);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct) {
        clearInterval(timerInterval);
        optionsDiv.classList.add("options-locked");

        if (selected === correct) { 
            yayAudio.currentTime = 0; yayAudio.play();
            partyAudio.currentTime = 0; partyAudio.play();
            
            if (currentMistakes > 0) {
                praiseText.innerText = "Ù†Ø§ÙŠØ³ Ù„ÙƒÙ† Ù†Ø¨ÙŠ Ø§Ø­Ø³Ù†!";
            } else {
                praiseText.innerText = "Ø´Ø·ÙˆØ±ØªÙŠÙŠÙŠ";
            }
            praiseText.style.display = "block";
            fireConfetti();
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns[selected].classList.add('correct-highlight');
            setTimeout(() => { qIndex++; loadQuestion(); }, 3000);
        } else { 
            currentMistakes++;
            playPunishment(selected, correct); 
        }
    }

    function playPunishment(selectedIndex, correctIndex) {
        clearInterval(timerInterval);
        optionsDiv.classList.add("options-locked");
        wrongAudio.currentTime = 0; wrongAudio.play();
        const allBtns = document.querySelectorAll('.option-btn');
        let msg = "";
        if (currentMistakes === 1) {
            msg = (qIndex <= 1) ? "Ø´ÙÙŠÙƒ ØªØ±Ø§ Ø³Ù‡Ù„Ù‡ØŸ" : "Ø§ÙØ§ Ù…Ø§ ØªÙˆÙ‚Ø¹Øª Ø§Ù†Ùƒ Ù…Ø§ ØªØ¹Ø±Ù";
        } else {
            msg = "Ø­Ø²Ù†Øª Ø¹Ù„ÙŠÙƒ Ø¨Ø³Ø§Ø¹Ø¯Ùƒ";
            if (correctIndex !== undefined) allBtns[correctIndex].classList.add('correct-highlight');
            else allBtns[questions[qIndex].ans].classList.add('correct-highlight');
        }
        wrongOverlayText.innerText = msg;
        if (selectedIndex !== -1 && selectedIndex !== undefined) allBtns[selectedIndex].classList.add('wrong-highlight');
        wrongPopup.style.display = "block"; 
        wrongVideo.currentTime = 0; wrongVideo.play();
        wrongVideo.onended = () => {
            wrongPopup.style.display = "none";
            loadQuestionLogicOnly(); 
        };
    }

    function loadQuestionLogicOnly() {
        optionsDiv.classList.remove("options-locked");
        const q = questions[qIndex];
        let timeLeft = q.time;
        document.getElementById("timer").innerText = timeLeft;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft;
            if(timeLeft <= 0) { 
                clearInterval(timerInterval); currentMistakes++; playPunishment(-1); 
            }
        }, 1000);
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => btn.classList.remove('wrong-highlight'));
    }

    function showAdMessage(text, duration) {
        adMessage.innerText = text;
        adMessage.style.display = "block";
        if (duration) {
            setTimeout(() => { if(adMessage.innerText === text) adMessage.style.display = "none"; }, duration);
        }
    }

    function showCenterMessage(text) {
        centerOverlay.innerText = text;
        centerOverlay.style.display = "block";
    }
    
    function hideCenterMessage() {
        centerOverlay.style.display = "none";
    }

    function triggerAdSequence() {
        clearInterval(timerInterval);
        quizBox.style.display = "none";
        adLayer.style.display = "flex";
        
        adVideo.src = "https://res.cloudinary.com/dpvvxtuny/video/upload/ad1_pu40fk.mp4"; 
        adVideo.muted = false;
        adVideo.play();
        
        skipBtn.style.display = "block";
        skipBtn.innerText = "Skip Ad >>";
        skipBtn.style.pointerEvents = "auto";
    }

    async function handleSkipClick() {
        const btn = document.getElementById("skipBtn");
        skipAttempts++;

        if (skipAttempts === 1) {
            btn.style.pointerEvents = "none"; 
            
            showAdMessage("ÙƒÙ…Ø§Ù† Ù…Ø±Ù‡ Ù‚Ù„ØªØ´Ø§Øª");
            await delay(4000); // Ø²Ø¯Ù†Ø§ Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©
            
            showAdMessage("Ø¨Ø±ÙˆØ­ Ø§Ø­ÙˆÙ„ Ø²Ø±Ø§Ø¹ÙŠ Ø§Ø­Ø³Ù†");
            await delay(4000); // Ø²Ø¯Ù†Ø§ Ø§Ù„ÙˆÙ‚Øª
            
            showAdMessage("ÙˆÙŠØª Ø¨Ø­Ø§ÙˆÙ„ Ø§ØµÙ„Ø­");
            await delay(4000); // Ø²Ø¯Ù†Ø§ Ø§Ù„ÙˆÙ‚Øª
            
            adMessage.style.display = "none";
            await delay(2000);
            
            showAdMessage("Ø¬Ø±Ø¨ÙŠ Ù‡ÙŠÙƒ ÙŠÙ…ÙƒÙ† Ø¸Ø¨Ø·");
            btn.style.pointerEvents = "auto"; 
            
        } else if (skipAttempts === 2) {
            // === Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙÙˆØ¶Ù‰ ===
            adMessage.style.display = "none";
            btn.style.display = "none"; 
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© wrongAudio Ù‡Ù†Ø§

            // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ±ÙˆØ³ (Ø¨Ø·ÙŠØ¡ Ø«Ù… ÙŠØªØ³Ø§Ø±Ø¹)
            startVirusChaos();

            // 2. Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 17 Ø«Ø§Ù†ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„ØªØ¹Ø¨ÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
            await delay(17000);

            // 3. Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ØªØ§Ù… (Freeze)
            freezeVirusChaos(); // ÙŠÙˆÙ‚Ù Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + ÙŠÙˆÙ‚Ù ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù†ÙˆØ§ÙØ°
            adVideo.pause();    // ÙŠÙˆÙ‚Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
            
            // 4. Ø§Ù„Ù†ØµÙˆØµ ØªØ¸Ù‡Ø± Ø¨Ø¨Ø·Ø¡
            showCenterMessage("Ø§Ø­Ø§ Ø´Ùˆ ÙÙŠÙ‡");
            await delay(5000); // ÙˆÙ‚Øª ÙƒØ§ÙÙŠ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©

            showCenterMessage("ÙˆÙŠØª Ø¨Ø­Ø§ÙˆÙ„ Ø§ÙˆÙ‚ÙÙ‡");
            await delay(5000);

            showCenterMessage("Ù‡ÙÙÙ ØªØ¹Ø¨Øª Ù…Ø§Ù†ÙŠ Ø¹Ø§Ø±Ù ÙƒÙŠÙ Ø§Ø¹Ù…Ù„");
            await delay(5000);
            
            showCenterMessage("Ù‡ÙŠÙ†ÙŠ ØªÙ‡ÙƒØ±Øª\nÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ‡ÙƒØ±");
            await delay(5000);
            
            showCenterMessage("Ø®Ù„ÙŠÙ†ÙŠ Ø§Ø­Ø§ÙˆÙ„ ÙƒÙ…Ø§Ù† Ù…Ø±Ù‡ Ø§ØµÙ„Ø­");
            await delay(4000);
            
            hideCenterMessage();
            
            // 5. ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Dark1)
            adLayer.style.display = "none";
            virusContainer.style.display = "none"; 
            darkVideo.style.display = "block";
            darkVideo.muted = false;
            darkVideo.play();
            
            darkVideo.onended = () => {
                window.location.href = "space.html";
            };
        }
    }

    let virusTimeout;
    function startVirusChaos() {
        let speed = 2500; // Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ø§Ù‹ (2.5 Ø«Ø§Ù†ÙŠØ©)
        
        function loop() {
            createVirusWindow();
            
            // ØªØ³Ø±ÙŠØ¹ ØªØ¯Ø±ÙŠØ¬ÙŠ
            if(speed > 200) speed -= 150; 
            
            virusTimeout = setTimeout(loop, speed);
        }
        loop();
    }

    function freezeVirusChaos() {
        clearTimeout(virusTimeout); // Ù…Ø§ Ø¹Ø§Ø¯ ÙŠØ·Ù„Ø¹ Ù†ÙˆØ§ÙØ° Ø¬Ø¯ÙŠØ¯Ø©
        
        // ØªØ¬Ù…ÙŠØ¯ ÙƒÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
        const allVideos = document.querySelectorAll('.virus-window video');
        allVideos.forEach(vid => vid.pause());
    }

    function createVirusWindow() {
        const div = document.createElement('div');
        div.className = 'virus-window';
        
        const video = document.createElement('video');
        const mainAd = document.getElementById("adVideo");
        video.src = mainAd.src; 
        video.autoplay = true;
        video.loop = true;
        video.muted = false; 
        
        div.appendChild(video);
        
        // Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙÙŠ ÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
        const x = Math.random() * (window.innerWidth - 300); 
        const y = Math.random() * (window.innerHeight - 200);
        
        div.style.left = x + "px";
        div.style.top = y + "px";
        
        virusContainer.appendChild(div);
    }

    function showChat(text) {
        if(text === "") { loayChat.style.display = "none"; return; }
        loayChat.style.display = "block";
        loayChat.innerText = "Ù„Ø¤ÙŠ: " + text;
    }

    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");
    let particles = [];
    function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    function fireConfetti() {
        const colors = ['#ff4d6d', '#ffeb3b', '#00ffea', '#ff69b4', '#ffffff'];
        for (let i = 0; i < 100; i++) {
            particles.push({
                x: canvas.width / 2, y: canvas.height + 20,
                vx: (Math.random() - 0.5) * 15, vy: -(Math.random() * 15 + 10),
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 10 + 5, gravity: 0.5,
                rotation: Math.random() * 360, rotationSpeed: (Math.random() - 0.5) * 10
            });
        }
        updateConfetti();
    }
    function updateConfetti() {
        if (particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.rotation += p.rotationSpeed;
            ctx.save(); ctx.translate(p.x, p.y); ctx.rotate((p.rotation * Math.PI) / 180);
            ctx.fillStyle = p.color; ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size); ctx.restore();
        }
        particles = particles.filter(p => p.y < canvas.height + 50);
        requestAnimationFrame(updateConfetti);
    }
</script>
</body>
</html>