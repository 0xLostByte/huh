<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ØªØ­Ø¯ÙŠ Ù„Ø¤ÙŠ</title>
<style>
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙØ­Ø© */
    body {
        margin: 0; padding: 0; height: 100vh;
        background: black;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden; color: white;
        text-align: center; display: flex;
        justify-content: center; align-items: center;
    }

    /* Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ */
    #start-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 1000;
        display: none;
        flex-direction: column; justify-content: center; align-items: center;
        cursor: pointer;
    }
    .start-btn {
        padding: 20px 40px; font-size: 24px; font-weight: bold;
        background: #ff4d6d; color: white; border: none;
        border-radius: 50px; cursor: pointer;
        box-shadow: 0 0 20px rgba(255, 77, 109, 0.6);
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    #mainVideo { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        object-fit: cover; z-index: 10; display: none; 
    }
    
    /* Ø§Ù„Ø­ÙˆØ§Ø± */
    #dialogueOverlay { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); 
        z-index: 20; display: none; flex-direction: column; 
        justify-content: center; align-items: center; padding: 20px; 
    }
    .dialogue-text { font-size: 30px; font-weight: bold; color: #fff; text-shadow: 0 0 10px #ff69b4; opacity: 0; transition: opacity 0.5s; }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
    .glass-box { 
        position: relative; z-index: 30; 
        background: rgba(255, 255, 255, 0.15); 
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
        border-radius: 20px; padding: 20px; 
        width: 90%; max-width: 400px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        border: 1px solid rgba(255,255,255,0.3); 
        display: none; 
        transition: transform 0.3s; 
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
    #wrongPopup {
        position: relative; 
        width: 100%;
        height: 200px; 
        background: black;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        margin-bottom: 20px; 
        display: none; 
        overflow: hidden;
    }
    #wrongVideo { width: 100%; height: 100%; object-fit: cover; }
    
    /* Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ø·Ø£ */
    #wrongOverlayText {
        position: absolute;
        bottom: 20px; left: 50%; 
        transform: translateX(-50%);
        width: 90%;
        color: white;
        font-size: 16px;
        font-weight: bold;
        background: rgba(0, 0, 0, 0.6); 
        padding: 8px 12px;
        border-radius: 20px;
        text-shadow: 1px 1px 3px black;
        z-index: 5;
        pointer-events: none;
    }

    .timer { font-size: 40px; font-weight: bold; color: #ffeb3b; margin-bottom: 15px; }
    .question { font-size: 24px; margin-bottom: 25px; font-weight: bold; line-height: 1.4; dir: ltr; }
    
    .options-locked { pointer-events: none; opacity: 0.8; }

    .option-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: rgba(255,255,255,0.9); color: #333; border: none; border-radius: 12px; font-size: 18px; cursor: pointer; transition: 0.2s; direction: ltr; }
    .option-btn:active { transform: scale(0.95); }

    /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© */
    .correct-highlight {
        background-color: #2ecc71 !important; 
        color: white !important;
        box-shadow: 0 0 15px #2ecc71;
        transform: scale(1.05);
    }
    /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø© */
    .wrong-highlight {
        background-color: #e74c3c !important; 
        color: white !important;
    }

    /* Ù†Øµ Ø§Ù„Ù…Ø¯Ø­ */
    #praiseText {
        color: white; font-size: 28px; font-weight: bold;
        text-shadow: 0 0 15px #fff, 0 0 20px #ff4d6d;
        margin-bottom: 15px; display: none;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
    .ad-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 50; display: none; flex-direction: column; justify-content: center; align-items: center; }
    .ad-overlay video { width: 100%; height: auto; object-fit: contain; }
    .skip-btn { position: absolute; bottom: 30px; right: 20px; background: rgba(0,0,0,0.6); color: white; padding: 12px 25px; border: 1px solid white; border-radius: 5px; cursor: pointer; display: none; z-index: 60; font-size: 16px; }
    
    #adMessage {
        position: absolute;
        top: 15%;
        width: 100%;
        text-align: center;
        color: white;
        font-size: 24px;
        font-weight: bold;
        text-shadow: 2px 2px 8px black;
        z-index: 70;
        display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    }
    
    #loay-chat { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 15px 25px; border-radius: 25px; font-size: 18px; color: #00ffea; z-index: 100; display: none; width: 85%; text-align: center; border: 1px solid #00ffea; }

    /* ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ */
    #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
</style>
</head>
<body>

<audio id="yayAudio" src="yay.mp3"></audio>
<audio id="partyAudio" src="party.mp3"></audio>
<audio id="wrongAudio" src="wrong1.mp3"></audio>

<canvas id="confettiCanvas"></canvas>

<div id="start-overlay">
    <button class="start-btn" onclick="playForcedManually()">ØªØ¹Ø¨ÙŠ Ø§ÙŠØ¯Ùƒ Ø§Ù„Ø­Ù„ÙˆÙ‡ Ùˆ Ø§Ø¶ØºØ·ÙŠ</button>
</div>

<video id="mainVideo" playsinline></video>

<div id="dialogueOverlay">
    <div class="dialogue-text" id="dialogueText"></div>
</div>

<div class="glass-box" id="quizBox">
    
    <div id="wrongPopup">
        <video id="wrongVideo" src="wrong.mp4" playsinline></video>
        <div id="wrongOverlayText"></div>
    </div>

    <div id="praiseText"></div> 
    <div class="timer" id="timer">60</div>
    <div class="question" id="qText" dir="ltr"></div>
    <div id="options"></div>
</div>

<div class="ad-overlay" id="adLayer">
    <div id="adMessage"></div> 
    <h3 style="position:absolute; top:20px; left:20px; color:white; z-index:55; font-size:20px; font-weight:bold;">AD!</h3>
    <video id="adVideo" src="https://res.cloudinary.com/dpvvxtuny/video/upload/ad1_pu40fk.mp4" playsinline muted></video>
    <div class="skip-btn" id="skipBtn" onclick="handleSkipClick()">Skip Ad</div>
</div>

<div id="loay-chat"></div>

<script>
    const status = sessionStorage.getItem("meStatus");
    const startOverlay = document.getElementById("start-overlay");
    const mainVideo = document.getElementById("mainVideo");
    
    const dialogueOverlay = document.getElementById("dialogueOverlay");
    const dialogueText = document.getElementById("dialogueText");
    const quizBox = document.getElementById("quizBox");
    const adLayer = document.getElementById("adLayer");
    const skipBtn = document.getElementById("skipBtn");
    const loayChat = document.getElementById("loay-chat");
    const adVideo = document.getElementById("adVideo");
    const adMessage = document.getElementById("adMessage");
    
    const yayAudio = document.getElementById("yayAudio");
    const partyAudio = document.getElementById("partyAudio");
    const wrongAudio = document.getElementById("wrongAudio");
    const praiseText = document.getElementById("praiseText");
    
    const wrongPopup = document.getElementById("wrongPopup");
    const wrongVideo = document.getElementById("wrongVideo");
    const wrongOverlayText = document.getElementById("wrongOverlayText");
    const optionsDiv = document.getElementById("options");

    // === Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===
    const questions = [
        { q: "5 + 6 = ?", opts: ["10", "11", "12"], ans: 1, time: 60 },
        { q: "10 + 2 Ã— 5 = ?", opts: ["60", "20", "25"], ans: 1, time: 40 },
        { q: "50 - 5 Ã— 5 + 5 = ?", opts: ["0", "230", "30"], ans: 2, time: 30 },
        { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙƒØªØ¨ ÙˆÙ„Ø§ ÙŠÙ‚Ø±Ø£ØŸ", opts: ["Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø³Ø§Ø¹Ø©", "Ø§Ù„ÙƒØªØ§Ø¨"], ans: 0, time: 20 },
        { q: "Ø¨Ø³Ø±Ø¹Ø©! 50 Ã· 2 + 5ØŸ", opts: ["30", "25", "35"], ans: 0, time: 10 }
    ];

    let qIndex = 0;
    let timerInterval;
    let adStage = 1;
    let currentMistakes = 0; 
    let skipCountdownInterval;
    let adMessageTimeout; // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ ÙˆÙ‚Øª Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ù†Øµ

    window.onload = function() {
        mainVideo.style.display = "block";
        resizeCanvas();

        if (status === 'forced') {
            startOverlay.style.display = "flex";
            mainVideo.src = "forced.mp4";
        } else {
            startOverlay.style.display = "none";
            startLoveScenario();
        }
    };
    
    window.onresize = resizeCanvas;

    function playForcedManually() {
        startOverlay.style.display = "none";
        mainVideo.muted = false;
        mainVideo.play();
        mainVideo.onended = () => {
            mainVideo.style.display = "none";
            showDialogueSequence([
                { text: "Ù…Ø§ ØªÙˆÙ‚Ø¹Øª Ø§Ù†Ùˆ Ø§ÙƒÙˆÙ† Ø§Ø®Ø± ÙˆØ§Ø­Ø¯ğŸ˜”", time: 3000 },
                { text: "ÙÙŠ Ø§Ø³Ø¦Ù„Ù‡ Ù„Ø§Ø²Ù… ØªØ¬Ø§ÙˆØ¨ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ Ù‡ÙŠÙ‡ÙŠ", time: 3000 },
                { text: "good luck", time: 2000 }
            ]);
        };
    }

    function startLoveScenario() {
        mainVideo.src = "homer.mp4";
        mainVideo.muted = true;
        var p = mainVideo.play();
        if(p !== undefined){
            p.then(_=>{ setTimeout(()=>{ mainVideo.muted = false; }, 1000); }).catch(e=>{ console.log("Autoplay blocked"); });
        }
        mainVideo.onended = () => {
            mainVideo.src = "kiss.mp4";
            mainVideo.muted = false;
            mainVideo.play();
            mainVideo.onended = () => {
                mainVideo.style.display = "none";
                showDialogueSequence([
                    { text: "Ù†ÙˆØ±ØªÙŠ ÙŠ Ø¹ÙŠÙˆÙ†ÙŠ ÙƒÙ…Ø§Ù† Ù…Ø±Ù‡", time: 3000 },
                    { text: "Ø´ÙˆÙÙŠ Ø¨ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ø³Ø¦Ù„Ù‡ Ù„Ø§Ø²Ù… ØªØ¬Ø§ÙˆØ¨ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ ÙˆØ§Ø­Ø¨Ùƒ", time: 3000 },
                    { text: "ÙˆØµØ­ Ø§Ù†ØªØ¨Ù‡ÙŠ ØªØ¬Ø§ÙˆØ¨ÙŠ ØºÙ„Ø·", time: 5000 }, 
                    { text: "good luck", time: 2000 }
                ]);
            };
        };
    }

    function showDialogueSequence(messages) {
        dialogueOverlay.style.display = "flex";
        let i = 0;
        function showNext() {
            if (i < messages.length) {
                dialogueText.style.opacity = 0;
                dialogueText.innerText = messages[i].text;
                setTimeout(() => { dialogueText.style.opacity = 1; }, 100);
                setTimeout(() => { i++; showNext(); }, messages[i].time);
            } else {
                dialogueOverlay.style.display = "none";
                startQuiz();
            }
        }
        showNext();
    }

    function startQuiz() {
        document.body.style.background = "linear-gradient(135deg, #1e3c72, #2a5298, #ff7a8a)";
        quizBox.style.display = "block";
        loadQuestion();
    }

    function loadQuestion() {
        optionsDiv.classList.remove("options-locked");
        
        currentMistakes = 0; 
        praiseText.style.display = "none";
        
        const oldBtns = document.querySelectorAll('.option-btn');
        oldBtns.forEach(btn => {
            btn.classList.remove('correct-highlight', 'wrong-highlight');
        });

        if (qIndex === 3 && adStage === 1) { 
            triggerAdSequence(); 
            return; 
        }

        if (qIndex >= questions.length) {
            alert("Ø®Ù„ØµØªÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©! Ø±ÙˆØ­ÙŠ Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©"); 
            return; 
        } 

        const q = questions[qIndex];
        document.getElementById("qText").innerText = q.q;
        optionsDiv.innerHTML = "";
        
        let timeLeft = q.time;
        document.getElementById("timer").innerText = timeLeft;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft;
            if(timeLeft <= 0) { 
                clearInterval(timerInterval); 
                currentMistakes++; 
                playPunishment(-1); 
            }
        }, 1000);

        q.opts.forEach((opt, idx) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, q.ans);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct) {
        clearInterval(timerInterval);
        optionsDiv.classList.add("options-locked");

        if (selected === correct) { 
            yayAudio.currentTime = 0; yayAudio.play();
            partyAudio.currentTime = 0; partyAudio.play();
            
            if (currentMistakes > 0) {
                praiseText.innerText = "Ù†Ø§ÙŠØ³ Ù„ÙƒÙ† Ù†Ø¨ÙŠ Ø§Ø­Ø³Ù†!";
            } else {
                praiseText.innerText = "Ø´Ø·ÙˆØ±ØªÙŠÙŠÙŠ";
            }
            
            praiseText.style.display = "block";
            fireConfetti();
            
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns[selected].classList.add('correct-highlight');

            setTimeout(() => { qIndex++; loadQuestion(); }, 3000);
        } else { 
            currentMistakes++;
            playPunishment(selected, correct); 
        }
    }

    function playPunishment(selectedIndex, correctIndex) {
        clearInterval(timerInterval);
        optionsDiv.classList.add("options-locked");

        wrongAudio.currentTime = 0;
        wrongAudio.play();

        const allBtns = document.querySelectorAll('.option-btn');

        let msg = "";
        if (currentMistakes === 1) {
            if (qIndex === 0 || qIndex === 1) {
                msg = "Ø´ÙÙŠÙƒ ØªØ±Ø§ Ø³Ù‡Ù„Ù‡ØŸ";
            } else {
                msg = "Ø§ÙØ§ Ù…Ø§ ØªÙˆÙ‚Ø¹Øª Ø§Ù†Ùƒ Ù…Ø§ ØªØ¹Ø±Ù";
            }
        } else {
            msg = "Ø­Ø²Ù†Øª Ø¹Ù„ÙŠÙƒ Ø¨Ø³Ø§Ø¹Ø¯Ùƒ";
            if (correctIndex !== undefined) {
                 allBtns[correctIndex].classList.add('correct-highlight');
            } else {
                 const q = questions[qIndex];
                 allBtns[q.ans].classList.add('correct-highlight');
            }
        }

        wrongOverlayText.innerText = msg;

        if (selectedIndex !== -1 && selectedIndex !== undefined) {
            allBtns[selectedIndex].classList.add('wrong-highlight');
        }

        wrongPopup.style.display = "block"; 
        wrongVideo.currentTime = 0;
        wrongVideo.play();
        
        wrongVideo.onended = () => {
            wrongPopup.style.display = "none";
            loadQuestionLogicOnly(); 
        };
    }

    function loadQuestionLogicOnly() {
        optionsDiv.classList.remove("options-locked");

        const q = questions[qIndex];
        let timeLeft = q.time;
        document.getElementById("timer").innerText = timeLeft;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("timer").innerText = timeLeft;
            if(timeLeft <= 0) { 
                clearInterval(timerInterval); 
                currentMistakes++; 
                playPunishment(-1); 
            }
        }, 1000);
        
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => {
            btn.classList.remove('wrong-highlight');
        });
    }

    // === Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Øµ ÙˆØ¥Ø®ÙØ§Ø¦Ù‡ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ ===
    function showAdMessage(text) {
        clearTimeout(adMessageTimeout); // Ù…Ø³Ø­ Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚ Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØªØ¯Ø§Ø®Ù„
        adMessage.innerText = text;
        adMessage.style.display = "block";
        
        adMessageTimeout = setTimeout(() => {
            adMessage.style.display = "none";
        }, 3000); // ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯ 3000 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© (3 Ø«ÙˆØ§Ù†ÙŠ)
    }

    function triggerAdSequence() {
        clearInterval(timerInterval);
        
        quizBox.style.display = "none";
        adLayer.style.display = "flex";
        
        showAdMessage("Ø§ÙˆÙ‡ Ø§Ø¹Ù„Ø§Ù†"); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        
        // Ù‡Ù†Ø§ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø£Ø±Ø¯Ù†Ø§ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡ØŒ 
        // ÙˆÙ„ÙƒÙ† Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ ØºÙŠØ±Ù†Ø§Ù‡ ÙÙŠ HTMLØŒ ÙÙ‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ùˆ Ø§Ø­ØªØ¬Øª ØªØºÙŠØ± Ø§Ù„Ù…ØµØ¯Ø± Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
        adVideo.src = "https://res.cloudinary.com/dpvvxtuny/video/upload/ad1_pu40fk.mp4"; 
        adVideo.muted = false;
        
        adVideo.onended = function() {
            switchToAd2();
        };

        adVideo.play();
        startSkipCountdown();
    }

    function switchToAd2() {
        if (adStage === 2) return; 

        adStage = 2;
        adVideo.src = "ad2.mp4"; 
        adVideo.loop = true; 
        adVideo.play();
        
        adVideo.onended = null;

        showAdMessage("bruh ÙƒÙ…Ø§Ù† Ù…Ø±Ù‡"); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        
        setTimeout(() => {
             showAdMessage("Ù…Ø§ Ø§Ø¹Ø±Ù Ø§Ø¨Ø±Ù…Ø¬ Ø¨Ø­Ø§ÙˆÙ„ Ø§ØµÙ„Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ù‡"); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        }, 2000);
        
        startSkipCountdown();
    }

    function startSkipCountdown() {
        clearInterval(skipCountdownInterval);

        let count = 5;
        skipBtn.style.display = "block";
        skipBtn.style.pointerEvents = "none"; 
        skipBtn.style.background = "rgba(0,0,0,0.6)";
        skipBtn.style.color = "white";
        skipBtn.innerText = "Skip in " + count;
        
        skipCountdownInterval = setInterval(() => {
            count--;
            skipBtn.innerText = "Skip in " + count;
            if(count <= 0) {
                clearInterval(skipCountdownInterval);
                skipBtn.innerText = "Skip Ad >>";
                skipBtn.style.background = "yellow"; 
                skipBtn.style.color = "black";
                skipBtn.style.pointerEvents = "auto"; 
            }
        }, 1000);
    }

    let skipAttempts = 0;
    function handleSkipClick() {
        const btn = document.getElementById("skipBtn");
        if (adStage === 1) {
            skipAttempts++;
            if (skipAttempts === 1) {
                btn.style.pointerEvents = "none"; 
                btn.style.background = "grey";
                
                setTimeout(() => { 
                    switchToAd2();
                }, 1500);
            }
        } else if (adStage === 2) {
            // === Ø§Ù„Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØµÙˆØª ===
            adVideo.pause(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØªÙ…Ø§Ù…Ø§Ù‹
            adVideo.currentTime = 0; 
            
            adLayer.style.display = "none"; 
            quizBox.style.display = "block"; 
            loadQuestion();
        }
    }

    function showChat(text) {
        if(text === "") { loayChat.style.display = "none"; return; }
        loayChat.style.display = "block";
        loayChat.innerText = "Ù„Ø¤ÙŠ: " + text;
    }

    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");
    let particles = [];

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    function fireConfetti() {
        const colors = ['#ff4d6d', '#ffeb3b', '#00ffea', '#ff69b4', '#ffffff'];
        for (let i = 0; i < 100; i++) {
            particles.push({
                x: canvas.width / 2,
                y: canvas.height + 20,
                vx: (Math.random() - 0.5) * 15,
                vy: -(Math.random() * 15 + 10),
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 10 + 5,
                gravity: 0.5,
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * 10
            });
        }
        updateConfetti();
    }

    function updateConfetti() {
        if (particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.rotation += p.rotationSpeed;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate((p.rotation * Math.PI) / 180);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            ctx.restore();
        }
        particles = particles.filter(p => p.y < canvas.height + 50);
        requestAnimationFrame(updateConfetti);
    }
</script>
</body>
</html>